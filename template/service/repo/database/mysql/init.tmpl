package mysql

import (
	"fmt"
	"log"
	"os"

	"github.com/jmoiron/sqlx"
	"{{.ProjectName}}/util"
	_ "go.elastic.co/apm/module/apmsql/mysql"
)

var MysqlDB *sqlx.DB

func InitMysqlDbSqlx() {
	usernameAndPassword := fmt.Sprint(os.Getenv("MYSQL_DB_USER")) + ":" + fmt.Sprint(os.Getenv("MYSQL_DB_PASSWORD"))
	// usernameAndPassword := fmt.Sprint(os.Getenv("MYSQL_DB_USER")) + ":" + "!q2W_@Lf4n_#E4r_Qa51r"
	hostName := "tcp(" + fmt.Sprint(os.Getenv("MYSQL_DB_HOST")) + ":" + fmt.Sprint(os.Getenv("MYSQL_DB_PORT")) + ")"
	urlConnection := usernameAndPassword + "@" + hostName + "/" + fmt.Sprint(os.Getenv("MYSQL_DB_DATABASE")) + "?charset=utf8&parseTime=true&loc=UTC"
	db, err := util.BuildConnection(os.Getenv("MYSQL_DB_DRIVER"), urlConnection)
	if err != nil {
		log.Panicf("⇨ %s Data source %s , Failed : %s \n", os.Getenv("MYSQL_DB_DRIVER"), urlConnection, err.Error())
	} else {
		log.Printf("⇨ %s Data source %s:%s , Failed : %s \n", os.Getenv("MYSQL_DB_DRIVER"), urlConnection)
		DB = db
	}
}
